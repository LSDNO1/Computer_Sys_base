二层环路
  定义：交换机（二层设备）之间通过物理链路连成环状拓扑（物理成环），并且没有开启防环协议；
  危害：广播风暴（网络中存在大量广播报文）——浪费链路资源——消耗设备的开销；
            mac地址频繁漂移——流量无法互访；
  解决：开启防环协议（堆叠、生成树协议、链路聚合......）

生成树协议
  作用：防止环路产生；
  原理：在整个交换网络中计算一颗生成树，在交换机相连的端口中，选举出端口进行堵塞，被堵塞的端口无法收发任何的数据帧，从而实现防环；
  版本：
   STP——802.1d——慢收敛（30~50s）
   RSTP——802.1s——快收敛（秒级）
   MSTP——802.1w——多颗生成树

 STP 
   工作过程：
    1、在整个交换网络中选举出一台交换机作为根桥（ROOT）
    2、所有的非根交换机各选出一个根端口（RP）
    3、在所有二层链路上各选出一个指定端口（DP）
            一般情况下，根桥的所有接口均为DP
            交换机连接PC、路由器的端口均为DP
    4、剩余的端口置为非根非指定端口（AP），直接堵塞，用于防环；

   STP报文：BPDU（桥协议数据单元）
    分类：
     1、配置BPDU
          由根桥2s/次产生并且对外发送，其余交换机收到后会从DP端口转发；
          作用：1、维持根桥的地位（如果其余交换机20s内无法收到根桥发送的BPDU，则认为根桥故障）
                    2、选举根桥、端口角色；

          选举四要素：
            比较规则：顺序比较，数值越小越优
            ①根桥id
                指根桥的桥id；
                桥id：每个交换机都有，由stp优先级+mac地址组成；
                [S1]stp priority 4096       //修改交换机的STP优先级

            ②根路径开销
                指BPDU的发送者，到根桥的最短路径开销；
                其中根桥发送的BPDU根路径开销为0；
                interface GigabitEthernet0/0/1
                   stp cost 2000               //修改接口开销值

            ③发送者的桥id
                BPDU发送者的桥id         

            ④发送端口id
                BPDU的发送接口的优先级+端口编号
                接口优先级：默认为128；
                interface GigabitEthernet0/0/2
                  stp port priority 160              //修改端口的优先级

  
     2、TCN BPDU（拓扑变更通知BPDU）
          只有拓扑发生变化时会由发生变化的设备，进行发送，用于通知其他交换机网络改变；
         

    STP详细选举过程
      1、网络运行之初，所有交换机都会认为自己是根桥，所有的接口均为DP；
           所有的交换机均会产生配置BPDU，其中根桥id均为自身的桥id，向外发送；
           相互比较根桥id，其中最优的设备会成为根桥，其余交换机成为非根交换机，并且停止发送BPDU；
           选举完根桥后，全网的BPDU的根桥id均保持一致；

      2、选举RP
            每台非根交换机有且仅有一个RP；
              RP用于接收最优的BPDU；
              RP用于非根交换机从最短的路径访问根桥；
            选举RP比较根路径开销时，不看报文数值，直接比较各候选端口，去往根桥的开销，最小的为RP；

      3、选DP
            每段链路有且仅有一个DP；
            DP用于发送最优的BPDU，每段链路上，发送最优BPDU的几口为DP；
            选举DP，比较根路径开销时，直接比较报文数值；

      4、剩余的端口为AP（非根非指定端口），直接堵塞，用于防环；

  
  [S1]stp mode stp            //华为设备默认开启生成树协议，默认运行MSTP，该命令修改版本为STP；
  display stp brief              //查看STP的端口角色以及状态
  


            
 